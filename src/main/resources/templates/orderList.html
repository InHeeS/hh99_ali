<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <title>Product List</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<div class="header">
  <div class="center">
    <a th:href="@{/}" href="#">Home</a>
  </div>
  <div id="loggedOutButtons">
    <a href="/auth/user/login-page" class="header-button">로그인</a>
    <a href="/auth/user/signup-page" class="header-button">유저 회원가입</a>
    <a href="/auth/seller/signup-page" class="header-button">셀러 회원가입</a>
  </div>
  <div id="loggedInInfo" style="display: none;">
    <!-- username과 로그아웃 버튼을 같은 줄에 표시하기 위해 span 요소 사용 -->
    <span id="usernameSpan"></span>
    <a href="/" class="header-button" onclick="logout()">로그아웃</a>
  </div>
</div>

<div style="display: flex;">
  <!-- Aside Section -->
  <div th:replace="aside :: aside"></div>
  <div th:fragment="orders-list">
    <div class="order-list">
      <h1>주문 목록</h1>
      <table>
        <thead>
        <tr>
          <th>주문 번호</th>
          <th>상품 이미지</th>
          <th>상품 이름</th>
          <th>수량</th>
          <th>가격</th>
          <th>상태</th>
          <th>주문 일자</th>
        </tr>
        </thead>
        <tbody id="ordersTableBody">
        <!-- 데이터는 AJAX 요청을 통해 동적으로 채워집니다. -->
        </tbody>
      </table>
    </div>
  </div>
</div>
<script src="/js/basic.js">
  var Access_Token = localStorage.getItem("Access_Token");
  var Refresh_Token= localStorage.getItem("Refresh_Token");

  // 페이지 로드 시 주문 목록 요청
  window.onload = function() {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "api/user/orders");
    xhr.setRequestHeader("Access_Token", Access_Token);
    xhr.setRequestHeader("Refresh_Token", Refresh_Token);
    xhr.onload = function() {
      if (xhr.status === 200) {
        var response = JSON.parse(xhr.responseText);
        var ordersList = response.data;
        var tableBody = document.getElementById("ordersTableBody");
        ordersList.forEach(function(order) {
          var row = tableBody.insertRow();
          row.insertCell(0).textContent = order.id;
          var imgCell = row.insertCell(1);
          var img = document.createElement("img");
          img.src = order.productImg;
          img.alt = "상품 이미지";
          img.width = 50;  // 이미지 크기 조절 (원하는 크기로 변경 가능)
          imgCell.appendChild(img);
          row.insertCell(2).textContent = order.productName;
          row.insertCell(3).textContent = order.qnt;
          row.insertCell(4).textContent = order.totalPrice;
          row.insertCell(5).textContent = order.status;
          row.insertCell(6).textContent = order.createdAt;
        });
      } else {
        // 에러 처리
        console.error("Failed to fetch orders:", xhr.responseText);
      }
    };
    xhr.send();
  };
</script>
</body>
</html>