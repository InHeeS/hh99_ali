<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <title>Product List</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<div th:replace="header :: header"></div>

<div style="display: flex;">
  <!-- Aside Section -->
  <div th:replace="aside :: aside"></div>

<div class="seller-management-content"
     style="
     height: 600px;
     width: 800px;
     "
>
  <h1>Store Management</h1>


  <!-- 인증되지 않은(로그인하지 않은) 사용자에게 보임 -->
  <!-- 인증된(로그인한) 사용자에게 보임 -->

  <!-- ROLE_ADMIN 권한을 가지고 있다면 보임 -->
  <!-- ROLE_SUB_ADMIN 권한을 가지고 있다면 보임 -->
  <!-- ROLE_USER 권한을 가지고 있다면 보임 -->
  <!-- ROLE_ADMIN 혹은 ROLE_SUB_ADMIN 권한을 가지고 있다면 보임 -->

  <br/>
  <!--인증시 사용된 객체에 대한 정보-->
  <b>Authenticated DTO:</b>

  <br/>
  <!--인증시 사용된 객체의 Username (ID)-->
  <b>Authenticated username:</b>

  <br/>
  <!--객체의 권한-->
  <b>Authenticated admin role:</b>


  <form id="storeForm">
    <div class="form-group">
      <div>
        <label for="storeName">Store Name:</label>
      </div>
      <div>
        <input type="text" id="storeName" name="storeName">
      </div>
    </div>
    <div class="form-group1">
      <div>
        <label for="storeInfo">Store Info:</label>
      </div>
      <div>
        <textarea id="storeInfo" name="storeInfo"></textarea>
      </div>
    </div>
    <div class="button-group" role="group" aria-label="Basic example">
      <button type="button" class="btn btn-primary" onclick="createStore()">Create Store</button>
      <button type="button" class="btn btn-primary" onclick="updateStore()">Update Store</button>
      <button type="button" class="btn btn-primary" onclick="deleteStore()">Delete Store</button>
    </div>
  </form>

  <!-- Store Details -->
  <div id="storeDetails">
    <!-- Store details will be displayed here -->
  </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/js/storeManagement.js"></script>
</body>
<script src="/js/basic.js">
  window.onload = function() {
    // 1. 로컬 스토리지에서 JWT 토큰을 가져옵니다.
    const token = localStorage.getItem('Access_Token');
    console.log(token);

    // 2. JWT 토큰을 디코드하여 userType을 확인합니다.
    const decodedToken = atob(token.split('.')[1]);
    const payload = JSON.parse(decodedToken);

    // 3. userType이 "SELLER"인 경우에만 특정 메뉴를 보여줍니다.
    if (payload.userType !== 'SELLER') {
      document.getElementById('productManagement').style.display = 'none'; // 상품 관리 메뉴 숨기기
      document.getElementById('storeManagement').style.display = 'none';   // 매장 관리 메뉴 숨기기
    }
  }







  function createStore() {
    var storeData = {
      storeName: $('#storeName').val(),
      storeInfo: $('#storeInfo').val()
    };
    $.ajax({
      url: '/seller/store',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(storeData),
      success: function(response) {
        alert('Store created successfully');
        // Update the store details section with the new store data
        updateStoreDetails(response);
      },
      error: function(error) {
        alert('Failed to create store');
      }
    });
  }

  function updateStore() {
    var storeData = {
      storeName: $('#storeName').val(),
      storeInfo: $('#storeInfo').val()
    };
    $.ajax({
      url: '/seller/store',
      type: 'PUT',
      contentType: 'application/json',
      data: JSON.stringify(storeData),
      success: function(response) {
        alert('Store updated successfully');
        // Update the store details section with the updated store data
        updateStoreDetails(response);
      },
      error: function(error) {
        alert('Failed to update store');
      }
    });
  }

  function deleteStore() {
    $.ajax({
      url: '/seller/store',
      type: 'DELETE',
      success: function(response) {
        alert('Store deleted successfully');
        // Clear the store details section
        $('#storeDetails').empty();
      },
      error: function(error) {
        alert('Failed to delete store');
      }
    });
  }

  function updateStoreDetails(response) {
    var storeDetails = $('#storeDetails');
    storeDetails.empty();
    storeDetails.append('<p>Store Name: ' + response.storeName + '</p>');
    storeDetails.append('<p>Store Info: ' + response.storeInfo + '</p>');
  }

  // Load the store details when the page loads
  $(document).ready(function() {
    // TODO: Add logic to load store details on page load
  });
</script>
</html>