<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Order List</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<div th:replace="header :: header"></div>

<div style="display: flex;">
    <!-- Aside Section -->
    <div th:replace="aside :: aside"></div>
    <div th:fragment="orders-list">
        <div class="order-list" style="margin-left: 250px;">
            <h1>주문 목록</h1>
            <table>
                <thead>
                <tr>
                    <th>상점 id</th>
                    <th>상점 이름</th>
                    <th>상점 정보</th>
                </tr>
                </thead>
                <tbody id="storesTableBody">
                <!-- 데이터는 AJAX 요청을 통해 동적으로 채워집니다. -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Edit Store Information</h2>
        <label for="storeName">Store Name:</label>
        <input type="text" id="storeName" placeholder="Enter store name">
        <label for="info">Shop Information:</label>
        <input type="text" id="info" placeholder="Enter shop information">
        <button onclick="updateStore()">Save Changes</button>
    </div>
</div>
<div style="margin-top: 20px; text-align: center;">
    <button onclick="openModal()">Edit my store information</button>
</div>

<script>
    var Access_Token = localStorage.getItem("Access_Token");
    var Refresh_Token = localStorage.getItem("Refresh_Token");

    // 페이지 로드 시 주문 목록 요청
    window.onload = function () {
        // Send a GET request to the API endpoint to fetch the seller's products
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "api/seller/store");
        xhr.setRequestHeader("Access_Token", Access_Token);
        xhr.setRequestHeader("Refresh_Token", Refresh_Token);
        xhr.onload = function () {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                displayProducts(response);  // Display products on success
            } else {
                // Handle error
                console.error("Failed to fetch seller's products:", xhr.responseText);
            }
        };
        xhr.send();
    };

    // Function to display products in the HTML
    function displayProducts(stores) {
        var tableBody = document.getElementById("storesTableBody");
        // Clear any existing content in the table body
        tableBody.innerHTML = "";

        stores.forEach(function (store) {
            var row = tableBody.insertRow();

            // Add the product ID
            row.insertCell(0).textContent = store.sellerId;
            row.insertCell(1).textContent = store.storeName;
            row.insertCell(2).textContent = store.info;

        });
    }
    function openModal() {
        var modal = document.getElementById("modal");
        modal.style.display = "block";
    }

    function closeModal() {
        var modal = document.getElementById("modal");
        modal.style.display = "none";
    }
    function updateStore() {
        var storeName = document.getElementById("storeName").value;
        var info = document.getElementById("info").value;

        var xhr = new XMLHttpRequest();
        xhr.open("PUT", "api/seller/store");
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("Access_Token", Access_Token);
        xhr.setRequestHeader("Refresh_Token", Refresh_Token);
        xhr.onload = function () {
            if (xhr.status === 200) {
                console.log("Store information updated successfully.");
                closeModal(); // Close the modal after successful update
                // You may want to reload the page or update the store information in the UI
            } else {
                console.error("Failed to update store information:", xhr.responseText);
            }
        };
        var requestBody = JSON.stringify({
            "storeName": storeName,
            "info": info
        });
        xhr.send(requestBody);
    }

</script>